<div align="center">
<img src="https://rishavanand.github.io/static/images/greetings.gif" align="center" style="width: 100% " />
</div>

# Hadoop Map Reduce - Word Count
> This repository contains all of my code for developing Hadoop MapReduce (Word Count Example)
> with Java and run it on AWS EMR Cluster
>
> This was a practice for  Hadoop and Distributed Systems Course by [Garage Education](https://gability.com/en/courses/hadoop/).

## üìï  Table Of Contents
* [Installation](#-installation)
* [Introduction](#-introduction)
* [Code](#-code)
* [AWS Deployment](#-aws-deployment)
* [Resources](#-resources)
---

## üîß Installation
* **Java Installation** - Check whether the Java is installed or not using the following command.
  java -version
* **Hadoop Installation** - Check whether the Hadoop is installed or not using the following command.
  hadoop version
---
## ü™Ñ Introduction
### Hadoop WordCount operation occurs in 3 stages:
* Mapper Phase
* Shuffle/Group Phase
* Reducer Phase

### 1. Mapper Phase Execution
The text from the input text file is tokenized into words to form a key value pair with all the words present in the input text file. The key is the word from the input file and value is ‚Äò1‚Äô.

For instance if you consider the sentence ‚ÄúAn elephant is an animal‚Äù. The mapper phase in the WordCount example will split the string into individual tokens i.e. words. In this case, the entire sentence will be split into 5 tokens (one for each word) with a value 1 as shown below ‚Äì
>(an,1)\
(elephant,1)\
(is,1)\
(animal,1)

### 2. Shuffle Phase Execution
After the map phase execution is completed successfully, shuffle phase is executed automatically wherein the key-value pairs generated in the map phase are taken as input and then sorted in alphabetical order. After the shuffle phase is executed from the WordCount example code, the output will look like this
>(an,{1,1})\
(an,1)\
(animal,1)\
(elephant,1)\
(is,1)

### 3. Reducer Phase Execution
In the reduce phase, all the keys are grouped together and the values for similar keys are added up to find the occurrences for a particular word. It is like an aggregation phase for the keys generated by the map phase. The reducer phase takes the output of shuffle phase as input and then reduces the key-value pairs to unique keys with values added up. In our example ‚ÄúAn elephant is an animal.‚Äù is the only word that appears twice in the sentence. After the execution of the reduce phase of MapReduce WordCount example program, appears as a key only once but with a count of 2 as shown below
>(an,2)\
(animal,1)\
(elephant,1)\
(is,1)
---

## üìù Code
### The main program consists of three classes:
* **Driver class** (Public, void, static, or main; this is the entry point).
```
public static void main(String[] args) throws IOException,Exception{
        if(args.length != 2){
            System.err.println("Usage WordCount <input_file> <output_dir>");
            System.exit(2);
        }

        Configuration conf = new Configuration();

        Job job = Job.getInstance(conf, "Word Count");
        job.setJarByClass(WordCount.class);
        job.setMapperClass(MapperSide.class);
        job.setReducerClass(ReducerSide.class);
        job.setOutputKeyClass(Text.class);
        job.setOutputValueClass(IntWritable.class);

        FileInputFormat.addInputPath(job, new Path(args[0]));
        FileOutputFormat.setOutputPath(job, new Path(args[1]));
        System.exit(job.waitForCompletion(true) ? 0 : 1);
    }
```
* **The Map class** which extends the public class Mapper<KEYIN,VALUEIN,KEYOUT,VALUEOUT>  and implements the Map function.
```
public static class MapperSide extends Mapper<Object,Text,Text, IntWritable> {

        public void map(Object key, Text value, Context context) throws IOException, InterruptedException{

            StringTokenizer itr = new StringTokenizer(value.toString());
            final Text wordOut = new Text();
            IntWritable one = new IntWritable(1);
            while (itr.hasMoreTokens()){
                wordOut.set(itr.nextToken());
                context.write(wordOut, one);
            }
        }
    }
```
* **The Reduce class** which extends the public class Reducer<KEYIN,VALUEIN,KEYOUT,VALUEOUT> and implements the Reduce function.
```
public static class ReducerSide extends Reducer<Text, IntWritable, Text, IntWritable>{

        public void reduce(Text key, Iterable <IntWritable> values, Context context) throws IOException, InterruptedException{
            int count = 0;
            for (IntWritable val : values) {
                count += val.get();
            }
            IntWritable result = new IntWritable();
            result.set(count);
            context.write(key, result);
        }
    }
```
---
## üöÄ AWS Deployment
### 1. Creating EC2 Key Pairs
> EC2 dashboard > Network & Security > Key Pairs > Create key parir
### 2. Creating S3 Bucket
* Since we're using cloud storage we don't need to put our data files in project directory anymore
> S3 Buckets > Create bucket
### 3. Creating EMR cluster on EC2
> EMR > create cluster
* Specify S3 Folder in general configuration.
* In software configuration, EMR release should be compatible with hadoop version that you use in project configuration, in my case i used emr-5.10.0
* Choose the EC2 key pair we created before in Security and access
* Creating a cluster for the first time actually takes a few minutes
### 4. Export project as runnable JAR file and upload it in our bucket
> Cluster > Steps > Add step
* Step type will be Custom_Jar
* Then choose location for the JAR you uploaded before
* Next you will pass the file path of the input & output in arguments.

---
### 5. Shutdown The Cluster after finishing the job
* You shutdown cluster from EC2 not from EMR
> EC2 > Resources > Running Instances 
* Select running instances
* Then change action state to Terminate
> Actions > Instance state > Terminate
---

## üìö Resources
* [Input Data - Shakespeare Text File](https://ocw.mit.edu/ans7870/6/6.006/s08/lecturenotes/files/t8.shakespeare.txt)
* [Hadoop Distributed Systems Course By Garage Education](https://www.youtube.com/playlist?list=PLxNoJq6k39G8Ak39PDC-oYvp6ZRvIn3Pa)
* [Getting Map/Reduce up and running on AWS by Prof. Patterson](https://www.youtube.com/playlist?list=PLix7MmR3doRojx9jA5NIG_9soB0s4_CXp)

---
## ‚ú® Contribution

Contributions, issues, and feature requests are welcome!

To contribute to this project, see the GitHub documentation on **[creating a pull request](https://help.github.com/en/github/collaborating-with-issues-and-pull-requests/creating-a-pull-request)**.

---

## üëè Support

Give a ‚≠êÔ∏è if you like this project!
___________________________________

<p>&copy; 2022 Ahmed Ashraf</p>